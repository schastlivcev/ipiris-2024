# Инструменты проектирования и разработки информационных систем 2024
Работа выполнялась в Ubuntu 20.04 LTS в WSL 2.

## 1. Быки и коровы

Запуск:
```
chmod +x ./bulls-and-cows.sh
./bulls-and-cows.sh
```
или
```
bash bulls-and-cows.sh
```

В самой игре необходимо только вводить четырехзначное число с неповторяющимися цифрами до угадывания загаданного числа, например: `4687`.

## 2. Ханойская башня

Запуск:
```
chmod +x ./tower-of-hanoi.sh
./bulls-and-cows.sh
```
или
```
bash tower-of-hanoi.sh
```

В самой игре необходимо вводить литеру стека, из которого перекладывают, и литеру стека, в который перекладывают. Ввод возможен как слитно, так и через один пробел, регистр не важен, например: `ab`, `BC`, `A C`, `c b`.

## 3. Облачный сервер через bash-сценарий

### Подготовка

Перед запуском необходимо выполнить несколько предусловий:

1. Установить утилиту *jq* для обработки JSON-ответов:
	```
	sudo apt install -y jq
	```

2. Установить утилиту *Yandex Cloud CLI* для работы с *Yandex Cloud*:
	```
	curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash
	```

3. Авторизоваться в *Yandex Cloud* (для получения доступа к облаку и каталогу):
	```
	yc init
	```

### Запуск

Непосредственно запуск создания сети и подсети с виртуальной машиной:
```
chmod +x ./start-jmix-bookstore.sh
./start-jmix-bookstore.sh -c <YC_CLOUD_NAME> -f <YC_FOLDER_NAME> \
              [-n <NETWORK_NAME=jmix-network>] \
              [-s <SUBNET_NAME=jmix-subnet>] \
              [-v <VM_NAME=jmix-bookstore-vm>] \
              [-u <VM_USER_NAME=ipiris>]
```
или
```
bash start-jmix-bookstore.sh -c <YC_CLOUD_NAME> -f <YC_FOLDER_NAME> \
              [-n <NETWORK_NAME=jmix-network>] \
              [-s <SUBNET_NAME=jmix-subnet>] \
              [-v <VM_NAME=jmix-bookstore-vm>] \
              [-u <VM_USER_NAME=ipiris>]
```
Для запуска необходимо обязательно указать **`названия облака`** и **`каталога`** из Yandex Cloud в параметрах `-c` и `-f` соответственно - именно **названия**, а не идентификаторы.
Для того, чтобы их посмотреть, можно воспользоваться следующими функциями:
- Список доступных облаков:
	```
	yc resource-manager cloud list
	```
- Список доступных каталогов:
	```
	yc resource-manager folder list
	```

Также можно заполнить опциональные параметры: `название сети`, `название подсети`, `название виртуальной машины`, `имя пользователя в виртуальной машине`. В случае незаполнения будут использованы значения по умолчанию.
Дополнительно проверяется существуют ли указанные сеть и/или подсеть, если да, то виртуальная машина будет создаваться уже внутри них.

В конце исполнения будет выведено две строки:
- Строка для подключения к виртуальной машине по SSH, ее просто необходимо скопировать в терминал.
- Адрес для доступа к веб-приложению, который уже необходимо открыть в браузере.

## 4. Облачный сервер через Terraform-конфигурацию:

### Подготовка

Перед запуском также нужно выполнить пару предусловий:
1. Все предусловия из *Задания 3*.
2. Установить Terraform (в момент написания скачивание архива недоступно в РФ):
	```
	wget https://releases.hashicorp.com/terraform/1.10.5/terraform_1.10.5_linux_386.zip
	unzip terraform_1.10.5_linux_386.zip
	sudo mv terraform /usr/local/bin
	```
3. Добавить провайдер для подключения к Yandex Cloud в конфигурацию Terraform. Для этого необходимо в домашнем каталоге пользователя `~` создать файл `.terraformrc`, в который добавить следующий блок:
	```
	provider_installation {
	    network_mirror {
	        url = "https://terraform-mirror.yandexcloud.net/"
	        include = ["registry.terraform.io/*/*"]
	}
	    direct {
	        exclude = ["registry.terraform.io/*/*"]
	    }
	}
	```
### Запуск

Вся работа ведется в каталоге `yc_terraform`.

Перед применением конфигурации необходимо заполнить переменные в файле `terraform.tfvars`:
Здесь нужно обязательно указать **`идентификаторы облака`** и **`каталога`** в переменных `yc_cloud_id` и `yc_folder_id` соответственно - именно **идентификаторы**, а не названия, в отличие от *Задания 3*. Также обязательно нужно заполнить **`OAuth-токен`** в переменной **`token`**.
Идентификаторы облака и каталога можно посмотреть через:
```
yc resource-manager cloud list
yc resource-manager folder list
```
Токен можно создать с помощью функции:
```
yc iam create-token
```
Дополнительно можно указать опциональные параметры аналогично *Заданию 3*, добавив их в `terraform.tfvars`, названия и описания можно подсмотреть в `variables.tf`

После заполнения значений переменных можно приступать к применению конфигурации:
1. Сначала инициализируем конфигурацию:
	```
	terraform init
	```
2. (Опционально) Посмотреть план:
	```
	terraform plan
	```
3. Применить конфигурацию:
	```
	terraform apply
	```
В случае успешного выполнения будут выведены две переменные `ssh_command` и `app_url`, которые соответствуют *Строке для подключения к виртуальной машине по SSH* и *Адресу для доступа к веб-приложению* из *Задания 3*.

*Значения переменных в Terraform можно также передать при запуске:*
```
terraform apply -var="yc_cloud_id=VALUE" -var="yc_folder_id=VALUE"
```
*или через переменные окружения:*
```
export TF_VAR_yc_cloud_id="VALUE"
export TF_VAR_yc_folder_id="VALUE"
```

## 5*. Удаление ресурсов в облаке

Для завершения работы с сетью или подсетью из *Задания 3* или *Задания 4* нужно удалить все связанные ресурсы - это сеть, ее подсети, их виртуальные машины.
Чтобы это сделать, можно: 
- Воспользоваться приложенным скриптом `network-delete.sh`:
	```
	bash network-delete.sh <NETWORK_NAME> [SUBNET_NAME1 SUBNET_NAME2 ...]
	```
	Первым идет обязательный параметр с **`названием сети`**, далее опционально можно указать `названия подсетей`, если необходимо удалить только одну из нескольких подсетей. Если подсети были не указаны, то удалятся все подсети указанной сети и связанные с ними машины и сама сеть.

- Удалить созданные ресурсы конфигурации Terraform c помощью команды (запускать в каталоге `yc_terraform`):
	```
	terraform destroy
	```
